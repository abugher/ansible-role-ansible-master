---
install_packages:
  - 'rsync'             # Needed by synchronize module.
  - 'python3-dnspython' # Needed for:  lookup('dig', '[URL]')
  - 'ansible'
  - 'git'
  - 'openssl'           # Generate fingerprints from certificates.
install_files:
  - owner:              'ansible'
    group:              'ansible'
    mode:               '0600'
    src:                "../../../sensitive-ansible/inventory/hosts/{{ inventory_hostname }}/users/ansible/files/ssh_keys/id_rsa"
    dest:               '~ansible/.ssh/id_rsa'
  - owner:              'ansible'
    group:              'ansible'
    mode:               '0644'
    src:                "{{ role_path }}/../../inventory/hosts/{{ inventory_hostname }}/users/ansible/files/ssh_keys/id_rsa.pub"
    dest:               '~ansible/.ssh/id_rsa.pub'
lines_in_files:
  - line:               "{{ hostvars[groups['dns-internal'][0]]['ip_address'] }} {{ groups['dns-internal'][0] }}.{{ domain }} {{ groups['dns-internal'][0] }}  # Allow ansible to reach DNS server before DNS is up."
    regexp:             " {{ groups['dns-internal'][0] }}( |$)"
    path:               '/etc/hosts'
user_groups:
  - 'testvm-ssh-client'
users:
  - 'testvm-ssh-client'
