---
install_packages:
  - 'rsync'             # Needed by synchronize module.
  - 'python3-dnspython' # Needed for:  lookup('dig', '[URL]')
  - 'ansible'
  - 'git'
  - 'openssl'           # Generate fingerprints from certificates.
  - 'iptables'          # Mark packets for routing from test VM SSH client user to test VMs.
  - 'iproute2'          # Route marked packets from test VM SSH client user to test VMs.
  - 'bind9-dnsutils'    # For dig.
install_files:
  - owner:              'ansible'
    group:              'ansible'
    mode:               '0600'
    src:                "../../../sensitive-ansible/inventory/hosts/{{ inventory_hostname }}/users/ansible/files/ssh_keys/id_rsa"
    dest:               '~ansible/.ssh/id_rsa'
  - owner:              'ansible'
    group:              'ansible'
    mode:               '0644'
    src:                "{{ role_path }}/../../inventory/hosts/{{ inventory_hostname }}/users/ansible/files/ssh_keys/id_rsa.pub"
    dest:               '~ansible/.ssh/id_rsa.pub'
lines_in_files:
  - line:               "{{ hostvars[groups['dns-internal'][0]]['ip_address'] }} {{ groups['dns-internal'][0] }}.{{ domain }} {{ groups['dns-internal'][0] }}  # Allow ansible to reach DNS server before DNS is up."
    regexp:             " {{ groups['dns-internal'][0] }}( |$)"
    path:               '/etc/hosts'
testvm_ssh_client:      'testvm-ssh-client'
user_groups:
  - "{{ testvm_ssh_client }}"
users:
  - "{{ testvm_ssh_client }}"
